<h1><%= @mega_display[:model_display].header %></h1>

<%=@mf.record_wrapper.html_safe%>
<% @mega_display[:displayable_fields].each do | displayable_field | %>
  <% if @mf.name == 'ProfileTable' %>
    <tr><th><%=  best_in_place displayable_field[:field_display], :header, path: displayable_field[:field_display] %></th>
  <% end %>
  <%= @mf.field_wrapper.html_safe%>
  <%   
    instance_value = instance_variable_get("@" + displayable_field[:field].field)
    if instance_value.present? && (displayable_field[:field].field != 'field' and params[:action] == 'edit')
        value = instance_value 
    else
      if params[:action] == 'edit' 
        value= @mega_instance.read_attribute(displayable_field[:field].field) 
      else
        value = displayable_field[:field].default_value
      end
    end
  %>
  <%=render template: displayable_field[:field_display].format.tableize + "/show", locals: {displayable_field: displayable_field, obj: @mega_instance, mega_bar: @mega_display, value: value} %>
  <%= @mf.field_wrapper_end.html_safe %>
<%end %>
<%= @mf.record_wrapper_end.html_safe%>

