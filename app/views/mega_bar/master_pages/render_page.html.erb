<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>MEGA BAR yo</title>
    <%# Bootstrap CSS %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <%= stylesheet_link_tag "application", media: "all", "data-turbolinks-track" => true %>
    <%= stylesheet_link_tag "mega_bar/mega_bar", media: "all", "data-turbolinks-track" => true %>
    <%= stylesheet_link_tag "mega_bar/mega_block_tabs", media: "all", "data-turbolinks-track" => true %>
    <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
    <%= csrf_meta_tags %>
    <%# Bootstrap JS Bundle with Popper %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <%# Tab functionality for MegaBar %>
    <script>
      // Initialize tab functionality when DOM is ready
      document.addEventListener('DOMContentLoaded', function () {
        console.log('Loading tab functionality...');

        const tabItems = document.querySelectorAll('.mega-layout-section-tabs li');
        console.log('Found', tabItems.length, 'tabs');

        tabItems.forEach((tab, index) => {
          tab.style.cursor = 'pointer';
          tab.addEventListener('click', function (e) {
            console.log('Tab clicked:', index, this.textContent);

            if (!this.classList.contains('active')) {
              // Remove active class from all tabs and content
              document.querySelectorAll('.mega-layout-section-tabs li.active').forEach(el => el.classList.remove('active'));
              document.querySelectorAll('#content-tab .tab-content.active').forEach(el => {
                el.classList.remove('active');
                el.style.display = 'none';
              });

              // Add active class to clicked tab
              this.classList.add('active');

              // Show corresponding content
              const contentDiv = document.querySelector(`#content-tab .tab-content:nth-child(${index + 1})`);
              if (contentDiv) {
                contentDiv.classList.add('active');
                contentDiv.style.display = 'block';
                console.log('Showing content for tab', index);
              } else {
                console.log('No content found for tab', index);
              }
            } else {
              // Toggle off if clicking active tab
              this.classList.remove('active');
              const activeContent = document.querySelector('#content-tab .tab-content.active');
              if (activeContent) {
                activeContent.classList.remove('active');
                activeContent.style.display = 'none';
              }
            }
          });
        });
      });
    </script>
  </head>
  <body class='<%= @page_classes %>'>
    <h1 class='site_name' style=" margin-left: 18px;"><%= @site_name %></h1>
    <nav style='background-color: #eeeeee'>
      <span style=" margin-left: 18px;">
        <%= link_to 'Home', '/' %> | 
        <%= link_to 'My Pages', '/mega-bar/pages' %> |  
        <%= link_to 'My Models', '/mega-bar/models' %> | 
      </span>
      <% @current_user = @current_user  ? @current_user : MegaBar::User.find_by_id(session[:user_id]) if session[:user_id] %>
      <span style="float: right; margin-right: 18px;">
        <% if @current_user %>
          Logged in as <%= @current_user.email %> (<%= @current_user.pln %>) |
          <%= link_to 'Log Out', session_path("current"), method: "delete" %>
        <% else %>
          <%= link_to 'Sign Up', '/mega-bar/users/new' %> | 
          <%= link_to 'Log In', "/mega-bar/sessions/new" %>
        <% end %>
      </span>
    </nav>
    <%# = image_tag "music-warehouse.jpeg" %>
    <% flash.each do |key, msg| %>
      <div id="<%= key %>">
        <p><%= msg %></p>
        <div class="clear"></div>
      </div>
    <% end %>
    <% @page_layouts.each do |layout| %>
      <%=layout%>
    <% end %>
    <%= render partial: 'mega_bar_help_links' , locals: {:links => page_help_links} if administering_page? %>
    <%= page_admin_link %>
    <nav  style='background-color: #eeeeee'>
      <%= render "page_nav" %>
      <div class='admin_links'>To replace this global template, create a file at myapp/app/views/mega_bar/master_pages/render_page.html.erb that contains at least this: <span>&lt;% @page_layouts.each{ |layout| puts "&lt;div class='layout'&gt;#{layout}&lt;/div&gt;"  } %&gt;</span></div>
    </nav>
    <div>&nbsp;</div>
  </body>
</html>
